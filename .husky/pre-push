#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"
set -e

echo "pre-push: verifying API tests..."

# Only run in a pnpm workspace root
if [ ! -f pnpm-workspace.yaml ]; then
  echo "ℹ️ Not a pnpm workspace root — skipping API tests."
  exit 0
fi

# Only run if the API Jest config exists
if [ ! -f apps/api/jest.config.ts ]; then
  echo "ℹ️ apps/api/jest.config.ts not found — skipping API tests."
  exit 0
fi

# Run API tests (workspace mode)
pnpm -w jest --clearCache --config apps/api/jest.config.ts
pnpm -w exec nx run api:test --verbose

echo "✅ pre-push checks passed"
